"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}var nick,toMove,toResize,notes=new Array;function createAlert(t,e){return document.querySelector(".sign-in--alert").innerHTML=t,e&&(clearTimeout(e),console.log("s")),e=setTimeout(function(){document.querySelector(".sign-in--alert").innerHTML=""},5e3)}function login(t){var a=new XMLHttpRequest;a.open("GET","Frigo/users/".concat(t),!0),a.onreadystatechange=function(){if(4===a.readyState&&200===a.status){var t=JSON.parse(a.responseText),e=!0,n=!1,i=void 0;try{for(var o,c=t[Symbol.iterator]();!(e=(o=c.next()).done);e=!0){var s=o.value;notes.push(new card(s.Identity,s.Width,s.Height,s.Top,s.Left,s.Content,!0))}}catch(t){n=!0,i=t}finally{try{e||null==c.return||c.return()}finally{if(n)throw i}}}},a.send(),document.querySelector(".board--add").style.display="block",document.querySelector(".board--add").addEventListener("click",function(){notes.push(new card(notes.length+1,150,150,150,150,"",notes.length+1,!1))})}window.addEventListener("load",function(){var t,e=new RegExp("[a-zA-Z0-9]{4,}");document.querySelector("button[type=submit]").addEventListener("click",function(){""!==(nick=document.querySelector(".sign-in--nick").value)&&e.test(nick)?(document.body.removeChild(document.querySelector(".sign-in--view")),document.querySelector(".board--view").style.display="block",login(nick)):t=createAlert("Nie podano nazwy tablicy.",t)})});var card=function(){function a(t,e,n,i,o,c,s){_classCallCheck(this,a),this.ID=t,this.width=e,this.height=n,this.top=i,this.left=o,this.content=c,this.toMove=!1,this.toResize=!1,this.create(s)}return _createClass(a,[{key:"create",value:function(t){var n=this;if(this.card=document.createElement("div"),this.card.className="note",this.card.style.top="".concat(this.top,"px"),this.card.style.left="".concat(this.left,"px"),this.card.style.width="".concat(this.width,"px"),this.card.style.height="".concat(this.height,"px"),document.body.appendChild(this.card),this.card.id=this.ID,!1===t){var e=new XMLHttpRequest;e.open("GET","/add/".concat(nick,"/").concat(this.ID,"/").concat(this.width,"/").concat(this.height,"/").concat(this.top,"/").concat(this.left,"/").concat(this.ID),!0),e.send()}this.destroyButton=document.createElement("div"),this.card.appendChild(this.destroyButton),this.destroyButton.style.cssText="width: 15px; height: 15px; position: absolute; top: -15px; right: -15px; background-color: blue;",this.destroyButton.addEventListener("click",function(){n.card.remove();var t=new XMLHttpRequest;t.open("GET","Frigo/delete/".concat(nick,"/").concat(n.card.id),!0),t.send(),delete notes[n.ID]}),this.moveButton=document.createElement("div"),this.card.appendChild(this.moveButton),this.moveButton.style.cssText="width: 100%; height: 20%; position: absolute; bottom: 0; right: 0;",this.moveButton.addEventListener("mousedown",function(t){!1===n.toMove&&(n.toMove=!0,n.a=t.clientX-parseInt(getComputedStyle(n.card).left),n.b=t.clientY-parseInt(getComputedStyle(n.card).top))}),this.moveButton.addEventListener("mouseup",function(){if(!0===n.toMove){n.toMove=!1;var t=new XMLHttpRequest;t.open("GET","Frigo/position/".concat(nick,"/").concat(n.card.id,"/").concat(parseInt(n.card.style.top),"/").concat(parseInt(n.card.style.left)),!0),t.send()}}),this.resize=document.createElement("div"),this.card.appendChild(this.resize),this.resize.style.cssText="width: 15px; height: 15px; background-color: green; position: absolute; right: -15px; bottom: -15px",this.resize.addEventListener("mousedown",function(){0==n.toResize&&(n.toResize=!0)}),this.resize.addEventListener("mouseup",function(){if(!0===n.toResize){n.toResize=!1;var t=new XMLHttpRequest;t.open("GET","Frigo/size/".concat(nick,"/").concat(n.card.id,"/").concat(parseInt(n.card.style.width),"/").concat(parseInt(n.card.style.height)),!0),t.send()}}),document.body.addEventListener("mousemove",function(t){!0===n.toMove&&(n.card.style.left="".concat(t.clientX-n.a,"px"),n.card.style.top="".concat(t.clientY-n.b,"px")),!0===n.toResize&&(n.card.style.width="".concat(t.clientX-parseInt(getComputedStyle(n.card).left)-15,"px"),n.card.style.height="".concat(t.clientY-parseInt(getComputedStyle(n.card).top)-15,"px"))}),this.textPlace=document.createElement("div"),this.card.appendChild(this.textPlace),this.textPlace.style.cssText="position: absolute; top: 3%; left: 0; width: 100%; height: 80%; background-color: yellow;",this.textPlace.className="content",this.textPlace.innerHTML=this.content;var i=!1;this.card.addEventListener("dblclick",function(){!1===i&&(i=!0,n.textEditor=document.createElement("div"),n.textEditor.style.width="100%",n.textEditor.style.height="80%",n.textEditor.innerHTML=n.textPlace.innerHTML,n.saveExit=document.createElement("div"),n.saveExit.style.width="100%",n.saveExit.style.height="20%",n.tinyDestroyButton=document.createElement("div"),n.tinyDelete=document.createElement("img"),n.tinyDelete.src="assets/images/dist/delete.png",n.tinyDelete.style.height="50px",n.tinyDelete.style.marginTop="1%",n.tinyDelete.style.marginLeft="1%",n.tinyDelete.addEventListener("click",function(t){n.textPlace.innerHTML=tinyMCE.activeEditor.getContent({format:"raw"}),t.target.parentNode.parentNode.parentNode.removeChild(t.target.parentNode.parentNode);var e=new XMLHttpRequest;e.open("POST","Frigo/content",!0),e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.send("nick=".concat(nick,"&identity=").concat(n.card.id,"&content=").concat(n.textPlace.innerHTML)),i=!1}),n.saveExit.appendChild(n.tinyDelete),n.tinyDestroyButton.appendChild(n.saveExit),n.tinyDestroyButton.appendChild(n.textEditor),n.saveExit.className="saveExit",n.textEditor.className="editor",document.body.appendChild(n.tinyDestroyButton),tiny())}),this.card.addEventListener("click",function(){for(var t=1;t<=notes.length;t++)document.getElementById(t).style.zIndex=t;document.getElementById(n.card.id).style.zIndex=notes.length+1})}}]),a}();function tiny(){tinymce.init({selector:".editor",inline:!1,theme_advanced_resizing:!0,theme_advanced_resizing_use_cookie:!1,plugins:["autoresize","fullscreen"],toolbar:"insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | fullscreen",menubar:!0,autoresize_max_height:50,autosave_interval:"5s"})}Element.prototype.remove=function(){this.parentElement.removeChild(this)},NodeList.prototype.remove=HTMLCollection.prototype.remove=function(){for(var t=this.length-1;0<=t;t--)this[t]&&this[t].parentElement&&this[t].parentElement.removeChild(this[t])};